<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis_mapper.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zhsj.api.dao.TBStoreAccountDao">

    <select id="getByAccount" resultType="storeAccountBean">
        SELECT id,account,password,open_id,name,head_img
        FROM tb_store_account
        WHERE status=1 and valid = 1 and account = #{account}
    </select>

    <insert id="insert" useGeneratedKeys="true" keyProperty="bean.id">
        INSERT INTO tb_store_account
        (account,password,mobile,status,valid,utime,ctime)
        VALUES
        (#{bean.account},#{bean.password},#{bean.mobile},1,1,unix_timestamp(now()),unix_timestamp(now()))
    </insert>

    <select id="getByOpenId" resultType="storeAccountBean">
        SELECT id,account,password,open_id,name
        FROM tb_store_account
        WHERE status=1 and valid = 1 and open_id = #{openId}
    </select>

    <update id="updateOpenId">
        update tb_store_account
        set open_id = #{openId}
        <if test="name !=null and name != ''">
            ,name = #{name}
        </if>
        <if test="headImg !=null and headImg != ''">
            ,head_img = #{headImg}
        </if>
        where account=#{account} AND password=#{password} and status=1 and valid = 1
    </update>

    <update id="updatePassword">
        update tb_store_account
        set password = #{newPwd}
        where account=#{account} AND password=#{pwd} and status=1 and valid = 1
    </update>


    <select id="getListByIds" resultType="storeAccountBean">
        SELECT id,account,password,open_id,name,head_img
        FROM tb_store_account
        WHERE status=1 and valid = 1
        <choose>
            <when test="ids != null and ids.size() > 0">
                AND id IN
                <foreach collection="ids" item="id"
                         open="(" separator="," close=")" >
                    #{id}
                </foreach>
            </when>
            <otherwise>
                AND 1 = 0
            </otherwise>
        </choose>
    </select>
</mapper>